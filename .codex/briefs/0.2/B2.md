# B2 Alignment Brief

## Intent
- Emit minimal proof tags in VM execution when `DEV_PROOFS=1`.
- Provide observability for deltas, effects, lens ops, asserts, and CALL gate failures without affecting normal runtime.

## Derived Constraints (binding)
- Tags emitted only when `process.env.DEV_PROOFS === '1'` (TS) or equivalent env flag in Rust.
- Tag payload shapes:
  - `Witness { kind:"Witness", delta, effect }`
  - `Normalization { kind:"Normalization", target:"delta"|"effect"|"state" }`
  - `Transport { kind:"Transport", op:"LENS_PROJ"|"LENS_MERGE", region:string }`
  - `Refutation { kind:"Refutation", code:string, msg?:string }`
  - `Conservativity { kind:"Conservativity", callee:string, expected:string, found:string }`
- Witness & Normalization tags accompany each delta/effect pair.
- Transport tags emitted for every lens operation.
- Refutation tags for ASSERT failures or mismatched sig-hash; Conservativity tags for CALL gate failures.
- Tag payloads are structured canonical JSON and excluded from all hashes.

## Invariants & Oracles
- With DEV_PROOFS=1, tags appear in a dev sink/log; without it, runtime produces no tags.
- Existing tests remain green; new tests cover presence/absence of tags.

## Checklist for Coder
- [ ] Mirrors TS and Rust
- [ ] Uses canonical bytes (no JSON.stringify)
- [ ] Final state ends in r0
- [ ] JSON Pointers start with "/"
- [ ] Effects NF sorted unique
- [ ] Proof tags emitted when DEV_PROOFS=1 (if relevant)

## Lessons referenced
- A1: canonical bytes and float rejection
- A2: parity across runtimes
- A3: vector structure for delta/effect
- B1: tag definitions
