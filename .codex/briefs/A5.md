# A5 Alignment Brief

## Intent
- Execute shared conformance vectors through the Rust kernel.
- Confirm TS and Rust produce identical deltas and effects for every vector.

## Derived Constraints (binding)
- Test file `packages/tf-lang-l0-rs/tests/vectors.rs` loads JSON via `serde_json` from `tests/vectors/`.
- Vector schema: `bytecode.version` = "L0", `bytecode.regs`, and `bytecode.instrs: {op,...}[]`.
- VM runs each vector, then normalizes delta and effect (effect arrays sorted unique) before compare.
- Uses `canonical_json_bytes` and `blake3_hex` for comparisons; no `serde_json::to_string`.
- Final state must be derived from register 0; pointers are RFC6901.
- Test suite fails if any vector mismatches delta or effect.

## Invariants & Oracles
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml` runs vectors and passes.
- Non-determinism or float literals in vectors cause rejection with E_L0_FLOAT.

## Checklist for Coder
- [ ] Mirrors TS and Rust
- [ ] Uses canonical bytes (no JSON.stringify/to_string)
- [ ] Final state ends in r0
- [ ] JSON Pointers start with "/"
- [ ] Effects NF sorted unique
- [ ] Proof tags emitted when DEV_PROOFS=1 (if relevant)

## Lessons referenced
- A1: canonical JSON + BLAKE3
- A2: Rust encoder & hashing rules
- A3: vector semantics and expectations
- A4: TS runner behavior for parity
