# C1 — Host-lite + Worlds (knowledge)

## What tightened (this pass)
- **Unified path:** `makeRawHandler(method,url,bodyStr)` parses → `makeHandler` routes; `createServer` delegates to it.
- **Deterministic API:** all responses canonical JSON bytes; **400** `{error:"bad_request"}` on malformed JSON; **404** canonical for non-routes/methods.
- **State + bounds:** `/apply` **persists** world state; per-world **LRU cap = 32**, cache map size == worlds touched.

## What stayed (invariants)
- Endpoints **only** `POST /plan`, `POST /apply`.
- Proof tags **only** when `DEV_PROOFS=1`; zero extra work when off.
- No new runtime deps; **ESM `.js`** internal imports; **no deep imports** across packages.
- Package points to **`src/server.ts`** (`main`, `exports`).

## Tests / tripwires
- Byte-determinism for plan/apply (repeat requests → identical bytes).
- Gating count test (0 off, &gt;0 on; no hidden work off-mode).
- 400/404 coverage; multi-world LRU bound; import-hygiene sweep.
- Hermetic (no sockets/fs/network); parallel-safe.

## Rationale in one line
DI raw handler + unified exec + canonical errors + bounded cache gives minimal surface, deterministic behavior, and safe growth.

## Open follow-ups (non-blocking)
- Optional: return objects from handler + cache objects end-to-end (micro-perf); keep final canonicalization at server.
- Optional: docs stub under `packages/host-lite/README.md`.
