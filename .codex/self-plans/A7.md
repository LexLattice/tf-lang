# Plan for Task A7

## Steps
1. **Implement TS guardrail ops**
   - Create `packages/tf-lang-l0-ts/src/ops/index.ts` exporting five functions: `assertDimensionEq`, `lensMod`, `assertBounds`, `probeDeltaBounded`, `correctSaturate`.
   - Each function checks integer-only inputs and implements required semantics; `lensMod` and `correctSaturate` return transformed numbers.
   - Export a `registry` (TfRegistry) registering these functions under their `tf://â€¦@0.1` ids.
   - Re-export ops through `packages/tf-lang-l0-ts/src/index.ts`.
2. **Wire TS host to ops**
   - Update `packages/tf-lang-l0-ts/src/host/memory.ts` `call_tf` to delegate unknown ids to the ops registry.
3. **Implement Rust guardrail ops**
   - Add `packages/tf-lang-l0-rs/src/ops/mod.rs` with parallel functions and a `call` dispatcher.
   - Expose module in `packages/tf-lang-l0-rs/src/lib.rs`.
4. **Wire Rust test host to ops**
   - Update `packages/tf-lang-l0-rs/tests/vectors.rs` `DummyHost::call_tf` to invoke `tflang_l0::ops::call` for new ids.
5. **Add conformance vectors**
   - Create JSON vectors in `tests/vectors/` for each op demonstrating success cases and expected effects/deltas.
   - Use constants for inputs; apply `LENS_MERGE` when state mutation is needed.
6. **Documentation**
   - Append brief note to `.codex/JOURNAL.md` describing implementation.

## Test Changes
- `pnpm -C packages/tf-lang-l0-ts test`
- `pnpm -C packages/tf-lang-l0-ts vectors`
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml`

## Risks & Rollback
- **Host delegation:** misrouting `call_tf` could break existing ids; ensure fallback preserves previous behavior.
- **Integer checks:** missing `Number.isInteger`/`n.is_i64()` could allow floats; add explicit checks.
- **Vector correctness:** mismatched expected effects/deltas may cause failures; adjust vectors or ops accordingly.
- Rollback by reverting ops modules and host changes if tests fail.

## Definition of Done
- Ops implemented in both TS and Rust and reachable via `call_tf`.
- Five new vectors validate semantics.
- All listed tests pass.
- Journal updated.
