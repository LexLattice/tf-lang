# Plan for A7

## Steps
1. **Create TS guardrail ops**
   - Add `packages/tf-lang-l0-ts/src/ops/` with modules `dimension_eq.ts`, `lens_mod.ts`, `bounds.ts`, `delta_bounded.ts`, `saturate.ts` and index re-export.
   - Each op exposes a function implementing minimal behavior described in brief.
2. **Wire TS host**
   - Update `packages/tf-lang-l0-ts/src/host/memory.ts` `call_tf` to handle new `tf://...@0.1` ids by invoking ops.
3. **Create Rust guardrail ops**
   - Add `packages/tf-lang-l0-rs/src/ops/` with modules `dimension_eq.rs`, `lens_mod.rs`, `bounds.rs`, `delta_bounded.rs`, `saturate.rs` and `mod.rs` to re-export.
4. **Wire Rust test host**
   - Update `call_tf` match arm in `packages/tf-lang-l0-rs/tests/vectors.rs` to use the new Rust op functions.
5. **Add conformance vectors**
   - Under `tests/vectors/` add JSON vectors verifying each op: `dimension_eq.json`, `lens_mod.json`, `bounds.json`, `delta_bounded.json`, `saturate.json`.
   - Each vector asserts successful behavior and records correct effects.
6. **Append journal entry**
   - Note completion in `.codex/JOURNAL.md`.

## Test Changes
- `pnpm -C packages/tf-lang-l0-ts test`
- `pnpm -C packages/tf-lang-l0-ts vectors`
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml`

## Risks & Rollback
- **Parity mismatch**: TS and Rust implementations may diverge; mitigate by keeping logic simple and mirrored. Rollback by reverting new op modules and host wiring.
- **Vector lint failures**: New vectors might violate lint rules; ensure pointers and lens usage follow conventions. Rollback by removing offending vector files.
- **Journal omissions**: `saturate` journaling skipped; if required later, update op and vectors.

## Definition of Done
- All new ops implemented in TS & Rust with host wiring.
- Five new conformance vectors pass in both TS and Rust runners.
- Existing tests remain green.
- `.codex/JOURNAL.md` updated with task entry.
