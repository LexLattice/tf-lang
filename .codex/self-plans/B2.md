# Plan for B2 (dev-proof gating with cache)

## Steps
1. Cache `DEV_PROOFS` flag in TS proof module; first `emit` reads env, later calls are zero-cost.
   - Provide `reset()` to clear log and cache.
2. Mirror caching in Rust using `OnceCell`; expose `reset()` clearing log and cache.
3. Refactor TS/Rust tests to use `reset()` and shared vector `tests/vectors/proof_dev.json`.
   - Assert tags emitted when enabled, none when disabled.
   - Verify env cache holds value until reset.
4. Build TS package and import compiled ESM to ensure resolution.
5. Document changes in `CHANGES.md` and add `B2-COMPLIANCE.md` checklist; update journal.

## Tests
- `pnpm -C packages/tf-lang-l0-ts build`
- `node -e "import('./packages/tf-lang-l0-ts/dist/index.js')"`
- `pnpm -C packages/tf-lang-l0-ts test`
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml`

## Risks
- Cache reset may not re-read env causing flaky tests.
- Path to shared vector may be incorrect for either runtime.
- OnceCell `take` may be unavailable on older compiler.

## Definition of Done
- Tags emitted only when `DEV_PROOFS=1`; disabled path is no-op.
- Env flag cached after first read with reset hook in both runtimes.
- Shared vector yields identical tag sets across TS/Rust and none when disabled.
- ESM build loads under Node without errors; all tests pass.
