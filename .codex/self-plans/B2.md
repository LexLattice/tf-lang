# Plan for B2

## Steps
1. Introduce cached `DEV_PROOFS` flag with reset hook in TS and Rust.
2. Move proof logs to thread/local structures (Rust) and module-local array (TS) and expose emit/flush without env checks.
3. Gate tag construction in interpreters via `devProofsEnabled()/enabled()` to avoid work when disabled.
4. Add shared vector `tests/vectors/proof_tags.json` and tests in both runtimes verifying tags when enabled and none when disabled.
5. Add caching/reset tests and parallel isolation tests; add ESM build test for TS.
6. Update CHANGES.md, create B2-COMPLIANCE.md, and append JOURNAL entry.

## Tests
- `pnpm -C packages/tf-lang-l0-ts test`
- `pnpm -C packages/tf-lang-l0-ts build`
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml`

## Risks
- Miscomputing path to shared vector in tests.
- Thread-local log misuse leading to borrow panics.
- Build step for ESM test may slow suite.

## Definition of Done
- Proof tags only emit when `DEV_PROOFS=1` with cached flag and reset hook.
- Rust/TS interpreters skip tag work when disabled.
- Shared vector verifies tag parity; tests deterministic under parallel runs.
- CHANGES.md and B2-COMPLIANCE.md updated; tests pass.
