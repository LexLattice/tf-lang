# Plan for Task B2

## Steps
1. Add proof-tag emission to TS VM (`packages/tf-lang-l0-ts/src/vm/interpreter.ts`).
   - Initialize optional `tags` array when `process.env.DEV_PROOFS === '1'`.
   - Provide `emit` helper and push Witness/Normalization tags after final delta, Transport tags for lens ops, Refutation on failed ASSERT, and Conservativity when `call_tf` returns `null`.
2. Mirror the same logic in Rust VM (`packages/tf-lang-l0-rs/src/vm/interpreter.rs`).
   - Use `Option<Vec<ProofTag>>` gated by `std::env::var("DEV_PROOFS") == Ok("1".into())`.
3. Add tests verifying tag emission and absence.
   - TS: new tests under `packages/tf-lang-l0-ts/tests` covering witness/transport, refutation, conservativity, and off-by-default.
   - Rust: analogous tests under `packages/tf-lang-l0-rs/tests`.
4. Append B2 entry to `.codex/JOURNAL.md`; add lesson if a general rule emerges.

## Test Changes
- `pnpm -C packages/tf-lang-l0-ts test`
- `pnpm -C packages/tf-lang-l0-ts vectors`
- `cargo test --manifest-path packages/tf-lang-l0-rs/Cargo.toml`

## Risks & Rollback
- Tag emission may alter runtime behavior if not fully gated; ensure tags only stored when flag enabled.
- Rust env handling may differ across platforms; tests set variable explicitly.
- Rollback by removing tag-related code and tests.

## Definition of Done
- TS and Rust VMs emit proof tags only when DEV_PROOFS=1.
- Tests cover presence/absence and pass alongside existing suite.
- Journal updated (and lesson added if applicable).
