
#!/usr/bin/env bash
# Pre-commit guard: run golden diff to enforce idempotent purpose.
set -euo pipefail

ROOT_DIR="$(git rev-parse --show-toplevel)"
cd "$ROOT_DIR"

# Skip in CI (since CI runs its own job) unless explicitly forced
if [[ -n "${CI:-}" && "${FORCE_LOCAL_HOOKS:-0}" != "1" ]]; then
  exit 0
fi

# If pnpm is missing, just warn
if ! command -v pnpm >/dev/null 2>&1; then
  echo "[pre-commit] pnpm not found; skipping golden check."
  exit 0
fi

./.codex/scripts/golden.sh
