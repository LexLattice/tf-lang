{
  "pipeline_id": "auto.fnol.fasttrack.v1",
  "created_at": "2025-09-30T11:37:59.839401Z",
  "effects": "Outbound+Inbound+Entropy+Pure",
  "nodes": [
    {
      "id": "S_receive_fnol",
      "kind": "Subscribe",
      "channel": "rpc:req:api/fnol/submit",
      "qos": "at_least_once",
      "out": {
        "var": "fnol_msg"
      }
    },
    {
      "id": "T_validate_fnol",
      "kind": "Transform",
      "spec": {
        "op": "jsonschema.validate",
        "schema": "FnolV1"
      },
      "in": {
        "value": "@fnol_msg.body"
      },
      "out": {
        "var": "validate_fnol_value"
      }
    },
    {
      "id": "K_get_policy",
      "kind": "Keypair",
      "algorithm": "Ed25519",
      "out": {
        "var": "kp_get_policy"
      }
    },
    {
      "id": "T_get_policy_corr",
      "kind": "Transform",
      "spec": {
        "op": "hash",
        "alg": "blake3"
      },
      "in": {
        "k": "@kp_get_policy.public_key_pem",
        "e": "api/policy/snapshot",
        "m": "GET",
        "q": {
          "policy_id": "@fnol_msg.body.policy_id"
        }
      },
      "out": {
        "var": "corr_get_policy"
      }
    },
    {
      "id": "T_get_policy_reply_to",
      "kind": "Transform",
      "spec": {
        "op": "concat"
      },
      "in": {
        "a": "rpc:reply:",
        "b": "@corr_get_policy"
      },
      "out": {
        "var": "reply_to_get_policy"
      }
    },
    {
      "id": "P_get_policy_request",
      "kind": "Publish",
      "channel": "rpc:req:api/policy/snapshot",
      "qos": "at_least_once",
      "payload": {
        "method": "GET",
        "corr": "@corr_get_policy",
        "reply_to": "@reply_to_get_policy",
        "query": {
          "policy_id": "@fnol_msg.body.policy_id"
        }
      }
    },
    {
      "id": "S_get_policy_reply",
      "kind": "Subscribe",
      "channel": "@reply_to_get_policy",
      "qos": "at_least_once",
      "filter": "@corr_get_policy",
      "out": {
        "var": "get_policy_reply"
      }
    },
    {
      "id": "T_score_severity",
      "kind": "Transform",
      "spec": {
        "op": "model_infer",
        "model": "auto.severity.v3"
      },
      "in": {
        "features": "@fnol_msg.body"
      },
      "out": {
        "var": "score_severity_value"
      }
    },
    {
      "id": "T_score_fraud",
      "kind": "Transform",
      "spec": {
        "op": "model_infer",
        "model": "fraud.v7"
      },
      "in": {
        "features": "@fnol_msg.body"
      },
      "out": {
        "var": "score_fraud_value"
      }
    },
    {
      "id": "T_eligibility",
      "kind": "Transform",
      "spec": {
        "op": "policy_eval",
        "policy": "fasttrack.policy.v1"
      },
      "in": {
        "input": {
          "severity": "@score_severity_value",
          "fraud": "@score_fraud_value",
          "policy": "@get_policy_reply.response"
        }
      },
      "out": {
        "var": "eligibility_value"
      }
    },
    {
      "id": "T_branch_1",
      "kind": "Transform",
      "spec": {
        "op": "eq"
      },
      "in": {
        "left": "@eligibility_value.decision",
        "right": "allow"
      },
      "out": {
        "var": "branch_1_value"
      }
    },
    {
      "id": "K_consent",
      "kind": "Keypair",
      "algorithm": "Ed25519",
      "out": {
        "var": "kp_consent"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "T_consent_corr",
      "kind": "Transform",
      "spec": {
        "op": "hash",
        "alg": "blake3"
      },
      "in": {
        "k": "@kp_consent.public_key_pem",
        "e": "api/consent/sign",
        "m": "POST",
        "b": {
          "doc": "fasttrack.pdf",
          "claimant": "@fnol_msg.body.party"
        }
      },
      "out": {
        "var": "corr_consent"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "T_consent_reply_to",
      "kind": "Transform",
      "spec": {
        "op": "concat"
      },
      "in": {
        "a": "rpc:reply:",
        "b": "@corr_consent"
      },
      "out": {
        "var": "reply_to_consent"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "P_consent_request",
      "kind": "Publish",
      "channel": "rpc:req:api/consent/sign",
      "qos": "at_least_once",
      "payload": {
        "method": "POST",
        "corr": "@corr_consent",
        "reply_to": "@reply_to_consent",
        "body": {
          "doc": "fasttrack.pdf",
          "claimant": "@fnol_msg.body.party"
        }
      },
      "when": "@branch_1_value"
    },
    {
      "id": "S_consent_reply",
      "kind": "Subscribe",
      "channel": "@reply_to_consent",
      "qos": "at_least_once",
      "filter": "@corr_consent",
      "out": {
        "var": "consent_reply"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "K_payout",
      "kind": "Keypair",
      "algorithm": "Ed25519",
      "out": {
        "var": "kp_payout"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "T_payout_corr",
      "kind": "Transform",
      "spec": {
        "op": "hash",
        "alg": "blake3"
      },
      "in": {
        "k": "@kp_payout.public_key_pem",
        "e": "api/payments/payout",
        "m": "POST",
        "b": {
          "claim": "@fnol_msg.body.claim_id",
          "amount": "@eligibility_value.amount",
          "channel": "SEPA"
        }
      },
      "out": {
        "var": "corr_payout"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "T_payout_reply_to",
      "kind": "Transform",
      "spec": {
        "op": "concat"
      },
      "in": {
        "a": "rpc:reply:",
        "b": "@corr_payout"
      },
      "out": {
        "var": "reply_to_payout"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "P_payout_request",
      "kind": "Publish",
      "channel": "rpc:req:api/payments/payout",
      "qos": "at_least_once",
      "payload": {
        "method": "POST",
        "corr": "@corr_payout",
        "reply_to": "@reply_to_payout",
        "body": {
          "claim": "@fnol_msg.body.claim_id",
          "amount": "@eligibility_value.amount",
          "channel": "SEPA"
        }
      },
      "when": "@branch_1_value"
    },
    {
      "id": "S_payout_reply",
      "kind": "Subscribe",
      "channel": "@reply_to_payout",
      "qos": "at_least_once",
      "filter": "@corr_payout",
      "out": {
        "var": "payout_reply"
      },
      "when": "@branch_1_value"
    },
    {
      "id": "P_emit_metric",
      "kind": "Publish",
      "channel": "metric:claims.fasttrack.success",
      "qos": "at_least_once",
      "payload": {
        "value": 1,
        "unit": "count",
        "tags": {
          "region": "@get_policy_reply.response.region"
        }
      },
      "when": "@branch_1_value"
    },
    {
      "id": "K_assign",
      "kind": "Keypair",
      "algorithm": "Ed25519",
      "out": {
        "var": "kp_assign"
      },
      "when": {
        "op": "not",
        "var": "branch_1_value"
      }
    },
    {
      "id": "T_assign_corr",
      "kind": "Transform",
      "spec": {
        "op": "hash",
        "alg": "blake3"
      },
      "in": {
        "k": "@kp_assign.public_key_pem",
        "e": "api/adjuster/assign",
        "m": "POST",
        "b": {
          "claim": "@fnol_msg.body.claim_id",
          "priority": "@score_severity_value.bucket"
        }
      },
      "out": {
        "var": "corr_assign"
      },
      "when": {
        "op": "not",
        "var": "branch_1_value"
      }
    },
    {
      "id": "T_assign_reply_to",
      "kind": "Transform",
      "spec": {
        "op": "concat"
      },
      "in": {
        "a": "rpc:reply:",
        "b": "@corr_assign"
      },
      "out": {
        "var": "reply_to_assign"
      },
      "when": {
        "op": "not",
        "var": "branch_1_value"
      }
    },
    {
      "id": "P_assign_request",
      "kind": "Publish",
      "channel": "rpc:req:api/adjuster/assign",
      "qos": "at_least_once",
      "payload": {
        "method": "POST",
        "corr": "@corr_assign",
        "reply_to": "@reply_to_assign",
        "body": {
          "claim": "@fnol_msg.body.claim_id",
          "priority": "@score_severity_value.bucket"
        }
      },
      "when": {
        "op": "not",
        "var": "branch_1_value"
      }
    },
    {
      "id": "S_assign_reply",
      "kind": "Subscribe",
      "channel": "@reply_to_assign",
      "qos": "at_least_once",
      "filter": "@corr_assign",
      "out": {
        "var": "assign_reply"
      },
      "when": {
        "op": "not",
        "var": "branch_1_value"
      }
    },
    {
      "id": "P_ack",
      "kind": "Publish",
      "channel": "@fnol_msg.reply_to",
      "qos": "at_least_once",
      "payload": {
        "corr": "@fnol_msg.corr",
        "status": "accepted"
      }
    },
    {
      "id": "T_record_digest",
      "kind": "Transform",
      "spec": {
        "op": "digest",
        "alg": "blake3"
      },
      "in": {
        "kind": "fasttrack.route",
        "payload": "@eligibility_value",
        "ts": "2025-09-30T11:37:59.839401Z"
      },
      "out": {
        "var": "record_digest_value"
      }
    },
    {
      "id": "T_record_id",
      "kind": "Transform",
      "spec": {
        "op": "encode_base58"
      },
      "in": {
        "value": "@record_digest_value"
      },
      "out": {
        "var": "record_id_value"
      }
    },
    {
      "id": "P_record",
      "kind": "Publish",
      "channel": "policy:record",
      "qos": "at_least_once",
      "payload": {
        "record_id": "@record_id_value",
        "kind": "fasttrack.route",
        "payload": "@eligibility_value",
        "ts": "2025-09-30T11:37:59.839401Z"
      }
    }
  ]
}
