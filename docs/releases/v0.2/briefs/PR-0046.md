# PR #46 — C1 synthesis: host‑lite finalize (pass‑4)

- PR: [#46](https://github.com/LexLattice/tf-lang/pull/46)

## Brief (verbatim)
```
Title: C1 synthesis: host-lite finalize (pass-4)

### Summary
- Dependency-injected `makeRawHandler(method,url,bodyStr)` → canonical 400/404 and delegate to `makeHandler`.
- Unified `exec(world, plan)` for both /plan and /apply; canonical JSON everywhere.
- Per-world LRU cache (cap 32); no leaks; proofs strictly behind DEV_PROOFS=1.
- ESM hygiene (.js suffix), public exports only, no runtime deps; package points to src/server.ts.

### Checklist
- [x] Endpoints only: POST /plan, /apply; others 404 canonical
- [x] Malformed JSON → 400 {"error":"bad_request"} (canonical)
- [x] Byte-identical determinism on repeats
- [x] DEV_PROOFS gating (0 when off; >0 when on) with no extra work off-mode
- [x] Per-world LRU cap = 32; cache map size == worlds touched
- [x] No deep imports; internal ESM imports include `.js`
- [x] No new runtime deps; tests hermetic; parallel-safe

### Evidence
- Code: `packages/host-lite/src/server.ts`, `src/makeRawHandler.ts`, `src/handler.ts`
- Tests: `test/c1.*.test.ts` (byte-determinism, gating-count, 400-404, multiworld-lru, import-hygiene)
- Packaging: `packages/host-lite/package.json` → `main: "src/server.ts"`, `exports: "./src/server.ts"`

### Notes
- Keeps C1 briefs unchanged. No schema changes.
```

## Summary (5 bullets)
- Exposes only POST `/plan` and `/apply` with canonical JSON.
- Canonical 400/404 handling via dependency‑injected raw handler.
- Per‑world LRU cache (cap 32), no leaks; proof tags behind `DEV_PROOFS=1`.
- ESM import hygiene; no new runtime deps; public exports only.
- Comprehensive tests cover determinism, gating, errors, cache, imports.

