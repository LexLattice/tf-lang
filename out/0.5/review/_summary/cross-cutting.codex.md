# Cross-Cutting Themes

* **Determinism gaps** — Multiple pipelines stamp artifacts with `new Date().toISOString()` (`tools/release/pack-all.mjs` and `scripts/docs/build.mjs`), and runtime passes rely on unordered iteration over Sets/Maps (`packages/tf-opt/lib/data.mjs`, `tools/release/pack-all.mjs`). Normalising timestamps and sorting outputs will stabilise CI snapshots across tracks A, C, and F.
* **Input validation drift** — Validators in LSP (`packages/tf-lsp-server/src/server.ts`), trace ingestion (`packages/tf-trace/src/lib/validate.ts`), and optimizer proofs (`packages/tf-l0-proofs/src/smt-laws.mjs`) either over-constrain (rejecting harmless fields) or under-constrain (trusting unsafe data). Consolidating schema helpers and tightening numeric/type checks would improve safety everywhere.
* **Performance hot spots** — Several components process large artifacts naively: LSP offset calculations (`packages/tf-lsp-server/src/server.ts`), trace CSV builders (`packages/tf-trace/bin/trace.mjs`), and plan exporters (`packages/tf-plan/src/index.ts`) all build huge intermediate strings or rescan whole buffers. Introducing streaming helpers and memoised offset tables should be shared infra work.
* **Shared CLI scaffolding** — Many scripts duplicate the same flag parsing and `emit(JSON)` pattern (`scripts/docs/build.mjs`, `tools/ci/lockfile-guard.mjs`, `tools/release/pack-all.mjs`), yet subtle divergences (e.g., useless `--json` flag) creep in. Extracting a tiny `tools/_cli/status.js` would unify behaviour and error messaging across tracks.
* **Law/optimizer contract mismatch** — Optimizer rewrites (`packages/tf-opt/lib/plan-apply.mjs`) assume SMT laws that currently fail to encode semantics (`packages/tf-l0-proofs/src/smt-laws.mjs`). Establishing a single source of truth for primitive metadata (catalog + proofs + runtime) would prevent rewrites from relying on unverifiable assumptions.
* **Configurable guardrails missing** — Both perf tooling (`packages/tf-trace/bin/trace.mjs`) and release scripts lack fast “dry-run” or sampling modes, forcing heavy invocations in CI. Providing standard `--limit`/`--dry-run` flags across CLIs would shrink feedback loops.
